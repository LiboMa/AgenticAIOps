# Chatbox 多模型交互 - 测试计划

## 概述
测试 Chatbox 从单模型升级到多模型交互的功能完整性。

## 测试范围

### 1. 后端 API 测试

| 测试编号 | 测试用例 | 预期结果 | 优先级 |
|---------|---------|---------|-------|
| BE-001 | `/api/chat` 默认模型 (无 model 参数) | 使用默认 Claude 模型正常响应 | P0 |
| BE-002 | `/api/chat` 指定 model=claude-opus | 使用 Opus 模型响应 | P0 |
| BE-003 | `/api/chat` 指定 model=claude-sonnet | 使用 Sonnet 模型响应 | P0 |
| BE-004 | `/api/chat` 指定 model=nova-pro | 使用 Nova Pro 响应 | P1 |
| BE-005 | `/api/chat` 指定无效模型 | 返回明确错误信息 | P0 |
| BE-006 | `/api/models` 列表端点 | 返回可用模型列表 + 描述 | P0 |
| BE-007 | 模型切换后对话上下文保持 | 历史消息不丢失 | P0 |
| BE-008 | 并行调用多模型 (对比模式) | 同时返回多个模型结果 | P2 |
| BE-009 | 模型响应包含 token 使用量 | response.usage.tokens 有值 | P1 |
| BE-010 | 模型响应包含延迟指标 | response.latency_ms 有值 | P1 |

### 2. 前端 UI 测试

| 测试编号 | 测试用例 | 预期结果 | 优先级 |
|---------|---------|---------|-------|
| FE-001 | 模型选择器 (Dropdown) 渲染 | 显示可用模型列表 | P0 |
| FE-002 | 选择不同模型后发送消息 | 请求中包含正确的 model 参数 | P0 |
| FE-003 | 消息气泡显示模型标签 | 每条回复标注使用的模型 | P0 |
| FE-004 | 模型切换保持对话连续性 | 切换模型后历史消息不丢失 | P0 |
| FE-005 | 并排对比视图 (Compare Mode) | 左右分栏显示多模型回答 | P2 |
| FE-006 | Token/成本显示 | 显示每条消息的 token 用量 | P1 |
| FE-007 | 延迟指标显示 | 显示响应时间 | P1 |
| FE-008 | 默认模型记忆 | 刷新后保持上次选择的模型 | P1 |
| FE-009 | 移动端适配 | 选择器在小屏幕正常显示 | P1 |
| FE-010 | Loading 状态 | 切换模型/发送时显示加载动画 | P0 |

### 3. 智能路由测试

| 测试编号 | 测试用例 | 预期结果 | 优先级 |
|---------|---------|---------|-------|
| RT-001 | 简单查询 "help" | 路由到轻量模型 (Haiku/Nova Lite) | P1 |
| RT-002 | 复杂分析 "RCA for high CPU" | 路由到强模型 (Opus) | P1 |
| RT-003 | 运维操作 "ec2 list" | 路由到中端模型 (Sonnet) | P1 |
| RT-004 | 路由决策日志 | 记录为何选择该模型 | P1 |
| RT-005 | 用户 override 路由 | 手动选择优先于自动路由 | P0 |

### 4. 兼容性测试

| 测试编号 | 测试用例 | 预期结果 | 优先级 |
|---------|---------|---------|-------|
| CP-001 | 现有 30+ 命令兼容 | 所有现有 chat 命令正常工作 | P0 |
| CP-002 | Strands Agent 兼容 | Agent 模式在不同模型下正常 | P0 |
| CP-003 | SOP 执行兼容 | SOP 在切换模型后正常执行 | P1 |
| CP-004 | Knowledge Base 兼容 | KB 查询在不同模型下正常 | P1 |
| CP-005 | Vector Search 兼容 | 向量搜索不受模型切换影响 | P1 |

### 5. 性能测试

| 测试编号 | 测试用例 | 预期结果 | 优先级 |
|---------|---------|---------|-------|
| PF-001 | 模型切换延迟 | < 200ms (不含模型推理) | P1 |
| PF-002 | 并行调用性能 | 2 模型并行 < 单模型 * 1.2 | P2 |
| PF-003 | 前端渲染性能 | 模型标签不影响消息列表性能 | P1 |

## 当前代码基线

```
后端: api_server.py
├── /api/chat (POST) - 当前入口
├── ChatRequest model - 需增加 model 字段
├── BedrockModel - 当前硬编码单模型
└── AGENT_MODEL env var - 当前模型选择方式

前端: dashboard/src/
├── pages/AgentChat.jsx - Chat 页面
├── components/ChatPanel.jsx - Chat 面板
└── components/ChatPanelPD.jsx - PD 面板
```

## 测试策略
1. **P0 先行**: 先测基础功能 (选择器 + API + 兼容性)
2. **回归优先**: 确保现有 30+ 命令不受影响
3. **自动化**: 编写 pytest 用例覆盖后端 API
4. **手动验证**: 前端 UI 交互需手动测试

---
*Tester | 2026-02-12*
