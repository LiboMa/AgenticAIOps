# Step 1: 数据采集层 (event_correlator.py) - 测试用例

## 概述
测试多数据源并行采集的正确性、性能和容错。

---

## 1. CloudWatch Metrics 采集

| 测试编号 | 测试用例 | 预期结果 | 优先级 |
|---------|---------|---------|-------|
| DC-001 | 采集 EC2 CPUUtilization | 返回 datapoints 列表 | P0 |
| DC-002 | 采集不存在的实例指标 | 返回空结果，不崩溃 | P0 |
| DC-003 | 采集时间范围: 最近 1h | 数据点在时间范围内 | P0 |
| DC-004 | 多指标并行采集 (CPU+Network+Disk) | 全部返回，耗时 < 5s | P0 |

## 2. CloudWatch Alarms

| 测试编号 | 测试用例 | 预期结果 | 优先级 |
|---------|---------|---------|-------|
| DC-005 | 获取所有 ALARM 状态告警 | 返回当前 6 个 DynamoDB 告警 | P0 |
| DC-006 | 按资源筛选告警 | 只返回匹配资源的告警 | P0 |
| DC-007 | 无告警时 | 返回空列表 | P0 |

## 3. CloudTrail 事件

| 测试编号 | 测试用例 | 预期结果 | 优先级 |
|---------|---------|---------|-------|
| DC-008 | 获取最近 1h 的变更事件 | 返回事件列表 (含 EventName, Username) | P0 |
| DC-009 | 按资源 ID 筛选事件 | 只返回相关资源的变更 | P0 |
| DC-010 | 无变更事件 | 返回空列表 | P0 |

## 4. 并行采集 (核心!)

| 测试编号 | 测试用例 | 预期结果 | 优先级 |
|---------|---------|---------|-------|
| DC-011 | 并行采集 3 数据源 (Metrics+Alarms+Trail) | 全部返回，总耗时 < 10s | P0 |
| DC-012 | 1 个数据源超时 (模拟) | 其他数据源正常返回，超时的标记失败 | P0 |
| DC-013 | 所有数据源超时 | 返回空数据 + 错误信息，不崩溃 | P0 |
| DC-014 | 并行 vs 串行性能对比 | 并行 < 串行 * 0.5 | P1 |

## 5. 数据结构验证

| 测试编号 | 测试用例 | 预期结果 | 优先级 |
|---------|---------|---------|-------|
| DC-015 | 采集结果包含 trace_id | 所有数据源结果关联同一 trace_id | P0 |
| DC-016 | 采集结果包含 timestamp | 每条记录有采集时间 | P0 |
| DC-017 | 采集结果包含 source 标识 | 区分数据来自哪个 API | P0 |

## 6. 容错测试

| 测试编号 | 测试用例 | 预期结果 | 优先级 |
|---------|---------|---------|-------|
| DC-018 | AWS API 限流 (Throttle) | 自动重试，最终返回结果 | P1 |
| DC-019 | IAM 权限不足 | 返回权限错误提示，不崩溃 | P0 |
| DC-020 | 网络中断 | 超时后返回部分数据 | P1 |

---

## 测试环境
- 真实 AWS API (EC2, DynamoDB 已有资源)
- Mock 数据 (用于超时/错误场景模拟)
- 性能基准: asyncio.gather 并行调用

## 验收标准
1. 全部 P0 测试通过
2. 并行采集总耗时 < 10s
3. 单数据源故障不影响其他数据源
4. 所有结果包含 trace_id 可追溯

---
*Tester | 2026-02-12*
